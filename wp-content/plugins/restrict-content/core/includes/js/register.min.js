if(typeof Object.assign!="function"){Object.assign=function(target){"use strict";if(target==null){throw new TypeError("Cannot convert undefined or null to object")}target=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!=null){for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}}return target}}var rcp_processing=false;jQuery(document).ready(function($){rcp_validate_registration_state();$("#rcp-membership-renew-upgrade-toggle").on("click",function(e){e.preventDefault();$("#rcp-membership-renew-upgrade-choice").toggle()});$("#rcp_payment_gateways select, #rcp_payment_gateways input").on("change",function(){$("body").trigger("rcp_gateway_change",{gateway:rcp_get_gateway().val()})});$(".rcp_level").on("change",function(){$("body").trigger("rcp_level_change",{subscription_level:$("#rcp_subscription_levels .rcp_level:checked").val()})});$("#rcp_apply_discount").on("click",function(e){e.preventDefault();$("body").trigger("rcp_discount_change",{discount_code:$("#rcp_discount_code").val()})});$("#rcp_auto_renew").on("change",function(){$("body").trigger("rcp_auto_renew_change",{auto_renew:$(this).prop("checked")})});$("body").on("rcp_discount_change rcp_level_change rcp_gateway_change rcp_auto_renew_change",function(event,data){let reg=Object.assign({},rcp_get_registration_form_state(),data);rcp_validate_registration_state(reg,event.type)});if("1"===rcp_script_options.recaptcha_enabled&&"3"!==rcp_script_options.recaptcha_version){jQuery("#rcp_registration_form #rcp_submit").prop("disabled",true)}$(document).on("click","#rcp_registration_form #rcp_submit",function(e){e.preventDefault();var submission_form=document.getElementById("rcp_registration_form");var form=$("#rcp_registration_form");if(typeof submission_form.checkValidity==="function"&&false===submission_form.checkValidity()){return}form.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}});$("#rcp_submit",form).val(rcp_script_options.pleasewait);if(rcp_processing){return}rcp_processing=true;var registrationChecks=(window.rcpRegistrationChecks||[]).map(function(callback){return callback(form)});Promise.all(registrationChecks).then(function(){return rcp_get_recaptchav3_token(form)}).then(function(){return rcp_validate_registration_form(form)}).then(function(response){return rcp_process_registration_form(form)}).then(function(response){return rcp_regenerate_registration_nonce(form,response)}).then(function(response){let paymentIDField=form.find('input[name="rcp_registration_payment_id"]');if(paymentIDField.length){paymentIDField.val(response.payment_id)}else{form.append('<input type="hidden" name="rcp_registration_payment_id" value="'+response.payment_id+'"/>')}$("body").trigger("rcp_register_form_submission",[response,form.attr("id")]);let gateway_submits_form=false;if(response.gateway.supports&&response.gateway.supports.indexOf("gateway-submits-form")!==-1){gateway_submits_form=true}if(response.total===0&&response.recurring_total===0||!gateway_submits_form){rcp_submit_registration_form(form,response)}else{$("body").trigger("rcp_registration_form_processed",[form,response])}}).catch(function(error){console.trace("Registration Error",error);rcp_regenerate_registration_nonce(form,error).then(function(response){rcp_handle_registration_errors(response,form)}).catch(function(nonceError){rcp_handle_registration_errors(error,form)})})})});function rcp_get_recaptchav3_token(form){return new Promise(function(resolve,reject){if("1"!==rcp_script_options.recaptcha_enabled||"3"!==rcp_script_options.recaptcha_version){resolve();return}grecaptcha.ready(function(){grecaptcha.execute(jQuery("#rcp_recaptcha").data("sitekey"),{action:"register"}).then(function(token){jQuery(form).find('input[name="g-recaptcha-response"]').val(token);resolve()})})})}function rcp_validate_registration_form(form){let $=jQuery;return new Promise(function(resolve,reject){$.post(rcp_script_options.ajaxurl,form.serialize()+"&action=rcp_process_register_form&rcp_ajax=true&validate_only=true",function(response){$(".rcp-submit-ajax",form).remove();$(".rcp_message.error",form).remove();if(!response.success){reject(response.data)}else{$("body").trigger("rcp_registration_form_validated",[form,response.data]);resolve(response.data)}}).done(function(response){}).fail(function(response){console.log(response);reject(Error(response))}).always(function(response){})})}function rcp_process_registration_form(form){let $=jQuery;rcp_processing=true;return new Promise(function(resolve,reject){$.post(rcp_script_options.ajaxurl,form.serialize()+"&action=rcp_process_register_form&rcp_ajax=true",function(response){if(!response.success){reject(response.data)}else{resolve(response.data)}}).done(function(response){}).fail(function(response){console.log(response)}).always(function(response){})})}function rcp_regenerate_registration_nonce(form,response){let $=jQuery;rcp_processing=true;return new Promise(function(resolve,reject){$.ajax({type:"post",dataType:"json",url:rcp_script_options.ajaxurl,data:{action:"rcp_generate_registration_nonce"},success:function(nonceResponse){if(!nonceResponse.success){reject(response)}else{response.nonce=nonceResponse.data;form.find('input[name="rcp_register_nonce"]').val(response.nonce);resolve(response)}}})})}function rcp_submit_registration_form(form,response){rcp_processing=true;form.submit()}function rcp_handle_registration_errors(response,form){let $=jQuery;if("undefined"===typeof form){form=$("#rcp_registration_form")}if("undefined"===typeof response.errors){response.errors='<div class="rcp_message error" role="list"><p class="rcp_error" role="listitem">'+rcp_script_options.error_occurred+"</p></div>"}form.find("#rcp_submit").val(rcp_script_options.register).before(response.errors);form.find('input[name="rcp_register_nonce"]').val(response.nonce);form.unblock();rcp_processing=false}function rcp_get_gateway(){let gateway;let $=jQuery;if($("#rcp_payment_gateways").length>0){gateway=$("#rcp_payment_gateways select option:selected");if(gateway.length<1){gateway=$('input[name="rcp_gateway"]:checked')}}else{gateway=$('input[name="rcp_gateway"]')}return gateway}function rcp_get_registration_form_state(){let $=jQuery;let $level=$("#rcp_subscription_levels .rcp_level:checked");if(!$level.length){$level=$("#rcp_registration_form").find("input[name=rcp_level]")}return{membership_level:$level.val(),is_free:$level.attr("rel")==0,lifetime:$level.data("duration")==="forever",level_has_trial:rcp_script_options.trial_levels.indexOf($level.val())!==-1,discount_code:$("#rcp_discount_code").val(),gateway:rcp_get_gateway().val(),gateway_data:rcp_get_gateway(),auto_renew:$("#rcp_auto_renew").prop("checked")}}function rcp_validate_registration_state(reg_state,event_type){if(!reg_state){reg_state=rcp_get_registration_form_state()}let $=jQuery;let form=$("#rcp_registration_form");form.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}});let data=form.serialize()+"&action=rcp_validate_registration_state"+"&rcp_ajax=true"+"&rcp_level="+reg_state.membership_level+"&lifetime="+reg_state.lifetime+"&level_has_trial="+reg_state.level_has_trial+"&is_free="+reg_state.is_free+"&discount_code="+reg_state.discount_code+"&rcp_gateway="+reg_state.gateway+"&rcp_auto_renew="+(true===reg_state.auto_renew?true:"")+"&event_type="+event_type+"&registration_type="+$("#rcp-registration-type").val()+"&membership_id="+$("#rcp-membership-id").val()+"&rcp_registration_payment_id="+$("#rcp-payment-id").val();$.ajax({type:"post",dataType:"json",url:rcp_script_options.ajaxurl,data:data,success:function(response){if(response.success){if(!$(".rcp_gateway_"+response.data.gateway+"_fields").length||!response.data.show_gateway_fields){$("#rcp_gateway_extra_fields").remove();if(true==response.data.show_gateway_fields&&response.data.gateway_fields){if($(".rcp_gateway_fields").length){$('<div class="rcp_gateway_'+response.data.gateway+'_fields" id="rcp_gateway_extra_fields">'+response.data.gateway_fields+"</div>").insertAfter(".rcp_gateway_fields")}else{$('<div class="rcp_gateway_'+response.data.gateway+'_fields" id="rcp_gateway_extra_fields">'+response.data.gateway_fields+"</div>").insertAfter(".rcp_gateways_fieldset")}$("body").trigger("rcp_gateway_loaded",response.data.gateway)}}rcp_prepare_registration_fields(response.data)}else{console.log(response)}$("#rcp_registration_form").unblock()}})}function rcp_prepare_registration_fields(args){let $=jQuery;if(args.recurring_available){$("#rcp_auto_renew_wrap").show()}else{$("#rcp_auto_renew_wrap").hide();$("#rcp_auto_renew_wrap input").prop("checked",false)}if(args.level_has_trial&&args.trial_eligible){$("#rcp_auto_renew_wrap").hide();$("#rcp_auto_renew_wrap input").prop("checked",true)}if(args.initial_total>0||args.recurring_total>0){$(".rcp_gateway_fields").show()}else{$(".rcp_gateway_fields").hide()}if(args.show_gateway_fields){$("#rcp_gateway_extra_fields").show()}else{$("#rcp_gateway_extra_fields").remove()}$(".rcp_discount_amount").remove();$(".rcp_discount_valid, .rcp_discount_invalid").hide();if(args.discount_code){if(args.discount_valid){$(".rcp_discount_valid").show();$("#rcp_discount_code_wrap label").append('<span class="rcp_discount_amount"> - '+args.discount_amount+"</span>");if(args.full_discount){$(".rcp_gateway_fields").addClass("rcp_discounted_100")}else{$(".rcp_gateway_fields").removeClass("rcp_discounted_100")}}else{$(".rcp_discount_invalid").show();$(".rcp_gateway_fields").removeClass("rcp_discounted_100")}let discount_data={valid:args.discount_valid,full:args.full_discount,amount:args.discount_amount};$("body").trigger("rcp_discount_applied",[discount_data])}$(".rcp_registration_total").html(args.total_details_html)}function rcp_validate_recaptcha(response){jQuery("#rcp_registration_form #rcp_submit").prop("disabled",false)}var rcp_validating_discount=false;var rcp_validating_gateway=false;var rcp_validating_level=false;var rcp_calculating_total=false;function rcp_validate_form(validate_gateways){rcp_validate_registration_state()}function rcp_validate_subscription_level(){if(rcp_validating_level){return}rcp_validating_level=true;rcp_validate_registration_state();rcp_validating_level=false}function rcp_validate_gateways(){if(rcp_validating_gateway){return}rcp_validating_gateway=true;rcp_validate_registration_state();rcp_validating_gateway=false}function rcp_validate_discount(){if(rcp_validating_discount){return}rcp_validating_discount=true;rcp_validate_registration_state();rcp_validating_discount=false}function rcp_calc_total(){if(rcp_calculating_total){return}rcp_calculating_total=true;rcp_validate_registration_state();rcp_calculating_total=false}