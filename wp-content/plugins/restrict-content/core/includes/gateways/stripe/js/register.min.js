!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){function r(e,t){jQuery.ajax({type:"post",dataType:"json",url:rcp_script_options.ajaxurl,data:{action:"rcp_stripe_handle_initial_payment_failure",payment_id:e,message:t},success:function(e){}})}function n(){if(!rcp_processing){let e=jQuery,t=e(".rcp-modal-wrapper"),r=e(".rcp-modal");t.fadeOut(250),r.hide(),document.getElementById("rcp-card-element")&&rcpStripe.elements.card.unmount("#rcp-card-element")}}jQuery((function(e){var t={hasPaymentMethod:!1,paymentMethodID:!1,init:function(){e("body").on("rcp_gateway_loaded",t.mountElements),e("#rcp_submit").on("click",t.maybeBlockSubmit),e("body").on("rcp_registration_form_processed",t.handlePayment),e("body").on("click",".rcp-stripe-register-submit-button",t.launchModal)},mountElements:function(e,r){document.getElementById("rcp-card-element")&&(rcpStripeUpdateElementStyles(rcpStripe.elements.card,".rcp_card_name"),rcpStripe.elements.card.mount("#rcp-card-element"),rcpStripe.elements.card.addEventListener("change",(function(e){e.complete&&(t.hasPaymentMethod=!0)})),t.setPaymentMethodID(),rcpStripe.elements.card.addEventListener("change",rcpStripeToggleElementErrors))},setPaymentMethodID:function(){let r=e('input[name="rcp_gateway_existing_payment_method"]');r.on("change",(function(r){rcpStripeToggleElementErrors(r),r=e('input[name="rcp_gateway_existing_payment_method"]:checked').val(),e(".rcp-gateway-saved-payment-method, .rcp-gateway-add-payment-method-wrap").removeClass("rcp-gateway-selected-payment-method"),"new"===r?(e(".rcp-gateway-new-card-fields").show(),e(".rcp-gateway-add-payment-method-wrap").addClass("rcp-gateway-selected-payment-method"),t.paymentMethodID=!1):(e(".rcp-gateway-new-card-fields").hide(),e(this).parents(".rcp-gateway-saved-payment-method").addClass("rcp-gateway-selected-payment-method"),t.paymentMethodID=r)})),r.trigger("change")},maybeBlockSubmit:function(e){if("stripe"===rcp_get_gateway().val()&&document.getElementById("rcp-card-element")&&!t.hasPaymentMethod&&!t.paymentMethodID)return e.stopPropagation(),rcpStripeHandleError(rcp_script_options.enter_card_details),!1},handlePayment:function(n,a,c){if("stripe"===c.gateway.slug&&(c.total||c.recurring_total&&c.auto_renew)&&!e(".rcp_gateway_fields").hasClass("rcp_discounted_100")){if(!c.gateway.data.stripe_client_secret)return rcpStripeHandleError(rcp_script_options.error_occurred),void r(c.payment_id,rcp_script_options.error_occurred);var o,p=e(".card-name").val(),d="payment_intent"===c.gateway.data.stripe_intent_type?"confirmCardPayment":"confirmCardSetup";let n={payment_method:{card:rcpStripe.elements.card,billing_details:{name:p}}};t.paymentMethodID&&(n={payment_method:t.paymentMethodID}),p=c.gateway.data.stripe_client_secret,o=n,rcpStripe.Stripe[d](p,o).then((function(e){e.error?(rcpStripeHandleError(e.error.message,e.error.code),r(c.payment_id,e.error.message)):rcp_submit_registration_form(a,c)}))}},launchModal:function(r){r.preventDefault();let a=e(".rcp-modal-wrapper"),c=e(".rcp-modal"),o=e(this).parents(".rcp-stripe-register");if(document.getElementById("rcp-card-element")){a.fadeIn(250),rcpStripe.elements.card.mount("#rcp-card-element");let r=c.find("input.rcp-modal-submit");rcpStripe.elements.card.addEventListener("change",(function(e){e.complete&&(t.hasPaymentMethod=!0)})),rcpStripe.elements.card.addEventListener("change",rcpStripeToggleElementErrors),t.setPaymentMethodID(),o.data("name")&&e(".rcp-modal-membership-name").text(o.data("name")).show(),o.data("description")&&e(".rcp-modal-membership-description").text(o.data("description")).show(),o.data("panel-label")&&r.val(o.data("panel-label")),o.data("level-id")&&c.find("#rcp-stripe-checkout-level-id").val(o.data("level-id")),c.fadeIn(250),a.find(".rcp-modal-close").on("click",(function(){n()})),e(document).on("keydown",(function(e){27===e.keyCode&&n()})),e(document).mouseup((function(e){c.is(e.target)||0!==c.has(e.target).length||n()}))}}};t.init()}))}]);
//# sourceMappingURL=register.min.js.map